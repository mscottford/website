// CloudFront Function for URL redirects
// Auto-generated by scripts/generate-s3-redirects.ts
// Do not edit directly - run: pnpm generate:redirects

var redirects = {
  'post/12600304604': 'articles/in-progress-a-day-with-data-context-interaction/',
  'post/12665897551': 'articles/when-you-go-in-the-mens-room-at-7-eleven-you/',
  'post/12719638808': 'articles/overheard-at-a-party/',
  'post/12837963246': 'articles/taps-the-rubygem/',
  'post/12889428573': 'articles/protect-the-internet/',
  'post/24627902270': 'articles/fix-annoying-issues-with-editing-previous-commands/',
  'post/25034749052': 'articles/hilarious-downtime-page-from-ifixit/',
  'post/25031162345': 'articles/rspec-performance-tip-only-run-databasecleaner/',
  'post/25106788989': 'articles/updated-fixed-verizon-router-keeps-changing-my/',
  'post/27629704898': 'articles/50-shades-of-analytics/',
  'post/28994318607': 'articles/reaction-to-140stitches/',
  'post/30384932840': 'articles/overheard-at-the-office-weight-loss-strategy/',
  'post/30910962407': 'articles/getting-spooky-remote-debugging-with-poltergeist/',
  'post/32244526040': 'articles/how-to-dvorak-japanese-keyboard-layouts-on-mac-os/',
  'post/37712903520': 'articles/monkey-patching-away-defaultscope/',
  'post/44838584540': 'articles/hooked-on-testing/',
  'post/46475507306': 'articles/hooked-on-testing-has-its-own-blog/',
  'post/59487920903': 'articles/epifywhat/',
  'post/68945201319': 'articles/relics-from-languages-past/',
  'post/188107128706': 'articles/does-your-team-prevent-you-from-refactoring/',
  'post/757620834301083648': 'articles/macbook-pro-keyboard-hacks-inspired-by/',
  'rss': 'feed.xml',
  'archive': 'articles/'
};

function handler(event) {
  var request = event.request;
  var uri = request.uri;

  // Remove leading slash for matching
  var path = uri.substring(1);

  // Check for exact prefix matches
  for (var prefix in redirects) {
    if (path === prefix || path.startsWith(prefix + '/')) {
      var target = redirects[prefix];
      return {
        statusCode: 301,
        statusDescription: 'Moved Permanently',
        headers: {
          'location': { value: '/' + target },
          'cache-control': { value: 'max-age=3600' }
        }
      };
    }
  }

  // Add index.html for directory requests (no extension)
  if (uri.endsWith('/')) {
    request.uri += 'index.html';
  } else if (!uri.includes('.')) {
    // No extension - try adding /index.html
    request.uri += '/index.html';
  }

  return request;
}
